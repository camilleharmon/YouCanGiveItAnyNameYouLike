<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Bouncing Enemies</title>
    <style> canvas {border: 1px solid black; width: 100%;}</style>
</head>
<body>
    <h1>Can You Make It Through?</h1>
    <canvas width="640" height="360" id="myCanvas"></canvas>
    <script>
        window.addEventListener('load', function(){
        /* always start and end with this */

        const GAME_WIDTH = 640;
        const GAME_HEIGHT = 360;
        let gameIsLive = true;

        let enemies = [
            {
            xPos: 100,
            yPos: 100,
            width: 40,
            height: 40,
            speed: 1,
            },
            {
            xPos: 260,
            yPos: 100,
            width: 40,
            height: 40,
            speed: 2,
            },
            {
            xPos: 380,
            yPos: 100,
            width: 40,
            height: 40,
            speed: 3,
            },
            {
            xPos: 450,
            yPos: 100,
            width: 40,
            height: 40,
            speed: 3,
            },
            {
            xPos: 590,
            yPos: 200,
            width: 40,
            height: 40,
            speed: 1
            }
            /* {
            xPos: 260,
            yPos: 100,
            width: 90,
            height: 40,
            speed: 2,
            },
            {
            xPos: 380,
            yPos: 100,
            width: 40,
            height: 60,
            speed: 3,
            },
            {
            xPos: 450,
            yPos: 100,
            width: 10,
            height: 10,
            speed: 7,
            },
            {
            xPos: 590,
            yPos: 200,
            width: 500,
            height: 30,
            speed: 1
            } */
        ];

        let player = {
            xPos: 50,
            yPos: 100,
            speedX: 2,
            width: 40,
            height: 40,
            isMoving: false
        }

        let goal = {

            xPos:600,
            yPos: 100,
            width: 50,
            height: 36
        } 

        function moveSelection(event){

            switch(event.keycode){

                case 38:
                moveUp();
                break;
                case 40:
                moveDown();
                break;
                case 37:
                moveLeft();
                break;
                case 39:
                moveRight();
                break;
            }
        }

        function moveLeft(){

            player.xPos += player.speedx - 5;
        }
        function moveUp(){

            player.yPos += player.speedY - 5;
        }
        function moveRight(){

            player.xPos += player.speedX + 5;
        }
        function moveDown(){

            player.yPos += player.speedY + 5;
        }
        

        let movePlayer = function(){

            player.isMoving = true;
        }

        let stopPlayer = function(){

            player.isMoving = false;
        }

         
        
        let canvas = document.getElementById("myCanvas");
        let ctx = canvas.getContext("2d");
        
        canvas.addEventListener("mousedown", movePlayer);
        canvas.addEventListener("mouseup", stopPlayer);
        canvas.addEventListener("touchstart", movePlayer);
        canvas.addEventListener("touchend", stopPlayer);

        let step = function()
        {
            update();
            draw();
            if(gameIsLive){

                window.requestAnimationFrame(step);   
            }
        };

        let update = function()
            {
            
             if(checkForCollision(player, goal)){

                gameIsLive = false;
                alert ("You win!");
                window.location = "";
            } 

            if(player.isMoving){

                player.xPos += player.speedX;
            }
            
            enemies.forEach(function(element, index)
                {
                    if(checkForCollision(player, element)){
                        gameIsLive = false;
                        alert("Game Over!");
                        //reload page
                        window.location = ";"
                        }
                    element.yPos += element.speed;
                if(element.yPos <= 10)
                    {
                    element.yPos = 10;
                    element.speed *= -1;
                    }
                else if(element.yPos >= GAME_HEIGHT - 50)
                    {
                    element.yPos = GAME_HEIGHT - 50;
                    element.speed *= -1;
                    }
                }
            )};

        let draw = function()
            {
            ctx.clearRect(0, 0, GAME_WIDTH, GAME_HEIGHT);
            
            ctx.drawImage(sprites.background, 0, 0);
            ctx.drawImage(sprites.player, player.xPos, player.yPos);
            ctx.drawImage(sprites.goal, goal.xPos, goal.yPos);
            
            enemies.forEach(function(element, index){

                ctx.drawImage(sprites.enemy, element.xPos, element.yPos);
            })
            /* ctx.fillStyle = "#64DC11";
            ctx.fillRect(goal.xPos, goal.yPos, goal.width, goal.height);

            ctx.fillStyle = "#ECB712";
            ctx.fillRect(player.xPos, player.yPos, player.width, player.height); */

            /* for(var i = 0; i < enemies.length; i++)
                {
                ctx.fillStyle = "#80224A";
                ctx.fillRect(enemies[i].xPos, enemies[i].yPos, enemies[i].height, enemies[i].width);
                } */
            }
            
            let checkForCollision = function(rect1, rect2){

                let closeOnWidth = Math.abs(rect1.xPos - rect2.xPos)
                <= Math.max(rect1.width, rect2.width);
                let closeOnHeight = Math.abs(rect1.yPos - rect2.yPos)
                <= Math.max(rect1.height, rect2.height);
                return closeOnHeight && closeOnWidth;
            }
        
        let sprites = {};
        
        let load = function(){

            sprites.player = new Image();
            sprites.player.src = "images/bord.png";
            sprites.background = new Image();
            sprites.background.src = "images/stonewall.png";
            sprites.enemy = new Image();
            sprites.enemy.src = "images/crabbs.png";
            sprites.goal = new Image();
            sprites.goal.src = "images/treasurechest.png";
        }
        
        load();
        step();
        });
</script>
</body>
</html>